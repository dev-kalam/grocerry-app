<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Grocery Shop Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
        }
        * {margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
        body {background-color:#f5f7fa;color:#333;min-height:100vh;}
        .container {max-width:1200px;margin:0 auto;padding:20px;}
        header {background-color:var(--primary);color:white;padding:15px 0;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
        .header-content {display:flex;justify-content:space-between;align-items:center;padding:0 20px;flex-wrap:wrap;}
        .logo {font-size:20px;font-weight:bold;}
        .nav {display:flex;list-style:none;margin-top:8px;}
        .nav-item {margin-left:12px;cursor:pointer;padding:8px 12px;border-radius:4px;transition:background-color 0.3s;}
        .nav-item:hover, .nav-item.active {background-color:rgba(255,255,255,0.08);}
        .page {display:none;padding:20px;background-color:white;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.05);margin-top:20px;}
        .page.active {display:block;}
        .page-title {margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid var(--light);color:var(--dark);}
        .form-group {margin-bottom:15px;position:relative;}
        label {display:block;margin-bottom:5px;font-weight:500;}
        input, select {width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;font-size:16px;}
        button {padding:10px 15px;background-color:var(--secondary);color:white;border:none;border-radius:4px;cursor:pointer;font-size:16px;transition:background-color 0.3s;}
        button:hover {background-color:#2980b9;}
        button.danger {background-color:var(--danger);}
        button.danger:hover {background-color:#c0392b;}
        button.success {background-color:var(--success);}
        button.success:hover {background-color:#27ae60;}
        table {width:100%;border-collapse:collapse;margin:20px 0;}
        th, td {padding:12px 15px;text-align:left;border-bottom:1px solid #ddd;}
        th {background-color:var(--light);font-weight:600;}
        tr:hover {background-color:#f9f9f9;}
        .invoice-container {padding:30px;border:1px solid #ddd;border-radius:8px;background-color:white;max-width:800px;margin:0 auto;}
        .invoice-header {text-align:center;margin-bottom:30px;}
        .invoice-details {display:flex;justify-content:space-between;margin-bottom:20px;}
        .invoice-items {margin:30px 0;}
        .invoice-total {text-align:right;font-size:18px;font-weight:bold;margin-top:20px;}
        .print-btn {margin-top:20px;background-color:var(--success);}
        .alert {padding:10px 15px;border-radius:4px;margin-bottom:15px;}
        .alert-success {background-color:#d4edda;color:#155724;border:1px solid #c3e6cb;}
        .alert-danger {background-color:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
        .barcode-scanner {display:flex;align-items:center;gap:8px;}
        .barcode-input {flex:1;}
        .search-btn {background-color:var(--primary);padding:10px 12px;}
        .scan-btn {background:transparent;border:none;color:var(--secondary);font-size:20px;cursor:pointer;padding:8px;border-radius:6px;}
        .action-btn {margin-right:5px;padding:5px 10px;font-size:14px;}
        .modal {display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.75);z-index:1000;justify-content:center;align-items:center;padding:20px;}
        .modal-content {background-color:white;padding:16px;border-radius:8px;width:480px;max-width:100%;}
        .modal-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
        .close-btn {background:none;border:none;font-size:24px;cursor:pointer;color:var(--dark);}
        .scanner-container {width:100%;height:360px;background-color:#f0f0f0;display:flex;justify-content:center;align-items:center;margin-bottom:10px;position:relative;overflow:hidden;border-radius:6px;}
        .scanner-overlay {position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box;pointer-events:none;}
        @media print {body * {visibility:hidden;} .invoice-container, .invoice-container * {visibility:visible;} .invoice-container {position:absolute;left:0;top:0;width:100%;} .no-print {display:none !important;}}
        .stock-update-form {display:flex;gap:10px;margin-top:10px;}
        .stock-update-form input {flex:1;}
        /* small mobile tweaks */
        @media (max-width:600px) {
            .header-content {flex-direction:column;align-items:flex-start;}
            .nav {margin-top:10px;flex-wrap:wrap;}
            .scanner-container {height:300px;}
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">Grocery Shop Manager</div>
            <ul class="nav">
                <li class="nav-item active" data-page="inventory">Inventory</li>
                <li class="nav-item" data-page="pos">Point of Sale</li>
                <li class="nav-item" data-page="sales">Sales History</li>
            </ul>
        </div>
    </header>

    <div class="container">
        <!-- Inventory Management Page -->
        <div id="inventory" class="page active">
            <h2 class="page-title">Inventory Management</h2>
            <div id="inventory-alert"></div>

            <form id="product-form">
                <div class="form-group">
                    <label for="product-name">Product Name</label>
                    <input type="text" id="product-name" required>
                </div>

                <div class="form-group" style="position:relative;">
                    <label for="product-barcode">Barcode</label>
                    <input type="text" id="product-barcode" required>
                    <button type="button" class="scan-btn" id="open-scanner-inventory" title="Scan barcode">
                        <i class="fas fa-barcode"></i>
                    </button>
                </div>

                <div class="form-group">
                    <label for="product-price">Price ($)</label>
                    <input type="number" id="product-price" min="0" step="0.01" required>
                </div>

                <div class="form-group">
                    <label for="product-quantity">Initial Quantity</label>
                    <input type="number" id="product-quantity" min="0" required value="1">
                </div>

                <button type="submit">Add Product</button>
            </form>

            <h3 style="margin-top: 30px;">Current Inventory</h3>
            <table id="inventory-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Barcode</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="inventory-list"></tbody>
            </table>
        </div>

        <!-- Point of Sale Page -->
        <div id="pos" class="page">
            <h2 class="page-title">Point of Sale</h2>
            <div id="pos-alert"></div>

            <div class="barcode-scanner" style="margin-bottom:8px;">
                <input type="text" id="barcode-input" class="barcode-input" placeholder="Scan or enter barcode">
                <button id="search-barcode" class="search-btn">Add Item</button>
                <button id="open-scanner-pos" class="scan-btn" title="Scan with camera"><i class="fas fa-camera"></i></button>
            </div>

            <h3 style="margin-top: 20px;">Current Sale</h3>
            <table id="cart-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="cart-items"></tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right; font-weight: bold;">Grand Total:</td>
                        <td id="cart-total">$0.00</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>

            <div style="margin-top: 20px; text-align: right;">
                <button id="complete-sale" class="print-btn">Complete Sale & Print Invoice</button>
            </div>
        </div>

        <!-- Sales History Page -->
        <div id="sales" class="page">
            <h2 class="page-title">Sales History</h2>
            <div id="sales-list"></div>
        </div>
    </div>

    <!-- Barcode Scanner Modal (shared for inventory & POS) -->
    <div id="scanner-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Scan Barcode</h3>
                <button class="close-btn" id="close-scanner">&times;</button>
            </div>
            <div id="scanner-container" class="scanner-container">
                <div class="scanner-overlay"></div>
                <!-- html5-qrcode will inject camera view here -->
            </div>
            <p style="text-align: center;">Point the barcode at the camera</p>
            <div class="form-group">
                <label for="manual-barcode">Or enter barcode manually:</label>
                <input type="text" id="manual-barcode" placeholder="Manual barcode">
            </div>
            <div style="display:flex;gap:8px;justify-content:center;">
                <button id="use-barcode" class="success">Use Barcode</button>
                <button id="try-camera-again" class="danger" style="background:#f39c12;border:none;">Restart Camera</button>
            </div>
        </div>
    </div>

    <!-- Update Stock Modal -->
    <div id="update-stock-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Stock</h3>
                <button class="close-btn update-close-btn">&times;</button>
            </div>
            <div class="form-group">
                <label for="update-product-name">Product:</label>
                <input type="text" id="update-product-name" readonly>
            </div>
            <div class="form-group">
                <label for="update-quantity">New Quantity:</label>
                <input type="number" id="update-quantity" min="0">
            </div>
            <button id="save-stock-update" class="success">Update Stock</button>
        </div>
    </div>

    <!-- Invoice Template (Hidden until printed) -->
    <div id="invoice-template" style="display: none;">
        <div class="invoice-container">
            <div class="invoice-header">
                <h1>Grocery Shop</h1>
                <p>123 Main Street, City, Country</p>
                <p>Phone: (123) 456-7890 | Email: info@groceryshop.com</p>
            </div>
            <div class="invoice-details">
                <div>
                    <p><strong>Invoice #:</strong> <span id="invoice-number"></span></p>
                    <p><strong>Date:</strong> <span id="invoice-date"></span></p>
                </div>
            </div>
            <div class="invoice-items">
                <table>
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Qty</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="invoice-items-list"></tbody>
                </table>
            </div>
            <div class="invoice-total">
                <p>Total: <span id="invoice-total-amount"></span></p>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <p>Thank you for your business!</p>
            </div>
        </div>
    </div>

    <script>
        // Data
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
        let sales = JSON.parse(localStorage.getItem('sales')) || [];
        let currentCart = [];
        let currentProductId = null;

        // Scanner state
        let html5QrCode = null;
        let scannerActive = false;
        // 'inventory' or 'pos' mode defines what we do on decode
        let scannerMode = 'inventory';

        // Elements
        const navItems = document.querySelectorAll('.nav-item');
        const pages = document.querySelectorAll('.page');
        const scannerModal = document.getElementById('scanner-modal');
        const updateStockModal = document.getElementById('update-stock-modal');

        document.addEventListener('DOMContentLoaded', function() {
            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const pageId = this.getAttribute('data-page');
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    pages.forEach(page => page.classList.remove('active'));
                    document.getElementById(pageId).classList.add('active');
                    if (pageId === 'sales') displaySalesHistory();
                    if (pageId === 'pos') {
                        // focus barcode input for convenience
                        setTimeout(() => { document.getElementById('barcode-input').focus(); }, 120);
                    }
                });
            });

            displayInventory();
            setupPOS();

            // Product form
            document.getElementById('product-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('product-name').value.trim();
                const barcode = document.getElementById('product-barcode').value.trim();
                const price = parseFloat(document.getElementById('product-price').value);
                const quantity = parseInt(document.getElementById('product-quantity').value);
                if (!name || !barcode || isNaN(price)) {
                    showAlert('inventory-alert','Please fill required fields!','danger'); return;
                }
                if (inventory.some(product => product.barcode === barcode)) {
                    showAlert('inventory-alert','Product with this barcode already exists!','danger');
                    return;
                }
                addProductToInventory(name, barcode, price, quantity);
                this.reset();
                document.getElementById('product-quantity').value = 1;
                showAlert('inventory-alert','Product added successfully!','success');
            });

            // Complete sale
            document.getElementById('complete-sale').addEventListener('click', function() {
                if (currentCart.length === 0) {
                    showAlert('pos-alert','Cart is empty!','danger'); return;
                }
                completeSale();
            });

            // Open scanner from inventory
            document.getElementById('open-scanner-inventory').addEventListener('click', function() {
                scannerMode = 'inventory';
                openScannerModal();
            });

            // Open scanner from POS
            document.getElementById('open-scanner-pos').addEventListener('click', function() {
                scannerMode = 'pos';
                openScannerModal();
            });

            document.getElementById('close-scanner').addEventListener('click', function() {
                closeScannerModal();
            });

            document.getElementById('use-barcode').addEventListener('click', function() {
                const manualBarcode = document.getElementById('manual-barcode').value.trim();
                if (manualBarcode) {
                    if (scannerMode === 'inventory') {
                        document.getElementById('product-barcode').value = manualBarcode;
                        showAlert('inventory-alert','Barcode entered manually.','success');
                    } else {
                        addProductToCartByBarcode(manualBarcode);
                    }
                    closeScannerModal();
                    document.getElementById('manual-barcode').value = '';
                } else {
                    showAlert((scannerMode === 'inventory') ? 'inventory-alert' : 'pos-alert','Please enter a barcode first.','danger');
                }
            });

            document.getElementById('try-camera-again').addEventListener('click', function() {
                if (scannerActive) stopBarcodeScanner().finally(() => startBarcodeScanner());
                else startBarcodeScanner();
            });

            // Update stock modal close
            document.querySelectorAll('.update-close-btn').forEach(btn => btn.addEventListener('click', function() {
                updateStockModal.style.display = 'none';
            }));

            document.getElementById('save-stock-update').addEventListener('click', function() {
                const newQuantity = parseInt(document.getElementById('update-quantity').value);
                if (isNaN(newQuantity) || newQuantity < 0) {
                    showAlert('inventory-alert','Please enter a valid quantity!','danger'); return;
                }
                const productIndex = inventory.findIndex(p => p.id === currentProductId);
                if (productIndex !== -1) {
                    inventory[productIndex].quantity = newQuantity;
                    saveInventory();
                    displayInventory();
                    updateStockModal.style.display = 'none';
                    showAlert('inventory-alert','Stock updated successfully!','success');
                }
            });
        });

        // Scanner modal control
        function openScannerModal() {
            scannerModal.style.display = 'flex';
            document.getElementById('manual-barcode').value = '';
            startBarcodeScanner();
        }
        function closeScannerModal() {
            scannerModal.style.display = 'none';
            stopBarcodeScanner();
        }

        async function startBarcodeScanner() {
            if (scannerActive) return;
            const scannerDivId = "scanner-container";
            html5QrCode = new Html5Qrcode(scannerDivId, /* verbose= */ false);
            const config = { fps: 10, qrbox: function(viewfinderWidth, viewfinderHeight) {
                // make qrbox a square centered and size ~70% of smallest dimension
                const minDim = Math.min(viewfinderWidth, viewfinderHeight);
                const size = Math.floor(minDim * 0.7);
                return { width: size, height: size };
            }};

            try {
                await html5QrCode.start(
                    { facingMode: { exact: "environment" } }, // prefer back camera
                    config,
                    (decodedText, decodedResult) => {
                        // On successful decode
                        if (!decodedText) return;
                        // Fill manual field so user can edit if needed
                        document.getElementById('manual-barcode').value = decodedText;
                        // Behavior based on scanner mode
                        if (scannerMode === 'inventory') {
                            document.getElementById('product-barcode').value = decodedText;
                            showAlert('inventory-alert','Barcode scanned and filled.','success');
                        } else {
                            // pos mode: add to cart
                            addProductToCartByBarcode(decodedText);
                        }
                        // stop scanner and close modal after small delay
                        setTimeout(() => { closeScannerModal(); }, 400);
                    },
                    (errorMessage) => {
                        // decode error callbacks — ignore silently or we could show small indicator
                        // console.debug("scan error", errorMessage);
                    }
                );
                scannerActive = true;
            } catch (err) {
                // try a more permissive camera constraint if exact fails (some devices)
                try {
                    await html5QrCode.start(
                        { facingMode: "environment" },
                        { fps: 10, qrbox: 250 },
                        (decodedText) => {
                            document.getElementById('manual-barcode').value = decodedText;
                            if (scannerMode === 'inventory') {
                                document.getElementById('product-barcode').value = decodedText;
                                showAlert('inventory-alert','Barcode scanned and filled.','success');
                            } else {
                                addProductToCartByBarcode(decodedText);
                            }
                            setTimeout(() => { closeScannerModal(); }, 400);
                        },
                        (errorMessage) => {}
                    );
                    scannerActive = true;
                } catch (err2) {
                    console.error('Camera start failed:', err2);
                    showAlert((scannerMode === 'inventory') ? 'inventory-alert' : 'pos-alert',
                              'Camera not available — try giving camera permission or use manual entry.', 'danger');
                }
            }
        }

        async function stopBarcodeScanner() {
            if (!html5QrCode) { scannerActive = false; return; }
            try {
                await html5QrCode.stop();
                await html5QrCode.clear();
            } catch (err) {
                // ignore stop errors
                console.warn('Stop error', err);
            }
            html5QrCode = null;
            scannerActive = false;
        }

        // Inventory display & operations
        function displayInventory() {
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = '';
            if (inventory.length === 0) {
                inventoryList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No products in inventory</td></tr>';
                return;
            }
            inventory.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.barcode}</td>
                    <td>$${product.price.toFixed(2)}</td>
                    <td>${product.quantity}</td>
                    <td><button class="action-btn success update-stock-btn" data-id="${product.id}"><i class="fas fa-edit"></i> Update Stock</button></td>`;
                inventoryList.appendChild(row);
            });
            document.querySelectorAll('.update-stock-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const product = inventory.find(p => p.id === productId);
                    if (product) {
                        currentProductId = productId;
                        document.getElementById('update-product-name').value = product.name;
                        document.getElementById('update-quantity').value = product.quantity;
                        updateStockModal.style.display = 'flex';
                    }
                });
            });
        }

        // POS setup
        function setupPOS() {
            const barcodeInput = document.getElementById('barcode-input');
            const searchBarcodeBtn = document.getElementById('search-barcode');
            // Add item by typing barcode
            searchBarcodeBtn.addEventListener('click', function() {
                const barcode = barcodeInput.value.trim();
                if (!barcode) { return; }
                addProductToCartByBarcode(barcode);
                barcodeInput.value = '';
                barcodeInput.focus();
            });
            barcodeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') { e.preventDefault(); searchBarcodeBtn.click(); }
            });
        }

        function addProductToInventory(name, barcode, price, quantity) {
            const newProduct = {id: Date.now(), name, barcode, price, quantity};
            inventory.push(newProduct);
            saveInventory();
            displayInventory();
        }

        function addProductToCartByBarcode(barcode) {
            const product = inventory.find(p => p.barcode === barcode);
            if (!product) { showAlert('pos-alert','Product not found!', 'danger'); return; }
            if (product.quantity <= 0) { showAlert('pos-alert','Product out of stock!', 'danger'); return; }
            const existingItem = currentCart.find(item => item.barcode === barcode);
            if (existingItem) {
                if (existingItem.quantity < product.quantity) existingItem.quantity++;
                else { showAlert('pos-alert','Not enough stock!', 'danger'); return; }
            } else currentCart.push({id: product.id, name: product.name, barcode: product.barcode, price: product.price, quantity: 1});
            updateCartDisplay();
            showAlert('pos-alert','Product added to cart!', 'success');
        }

        function updateCartDisplay() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            cartItems.innerHTML = '';
            let total = 0;
            currentCart.forEach(item => {
                const inventoryItem = inventory.find(p => p.id === item.id) || { quantity: 0 };
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>$${item.price.toFixed(2)}</td>
                    <td><input type="number" min="1" max="${inventoryItem.quantity}" value="${item.quantity}" data-barcode="${item.barcode}" class="quantity-update" style="width:70px;padding:6px;"></td>
                    <td>$${itemTotal.toFixed(2)}</td>
                    <td><button class="danger remove-item" data-barcode="${item.barcode}"><i class="fas fa-trash"></i></button></td>`;
                cartItems.appendChild(row);
            });
            cartTotal.textContent = `$${total.toFixed(2)}`;
            document.querySelectorAll('.quantity-update').forEach(input => {
                input.addEventListener('change', function() {
                    const barcode = this.getAttribute('data-barcode');
                    const newQuantity = parseInt(this.value);
                    if (newQuantity < 1) { this.value = 1; return; }
                    const product = inventory.find(p => p.barcode === barcode);
                    const cartItem = currentCart.find(item => item.barcode === barcode);
                    if (newQuantity > product.quantity) {
                        showAlert('pos-alert','Not enough stock!', 'danger');
                        this.value = cartItem.quantity;
                        return;
                    }
                    cartItem.quantity = newQuantity;
                    updateCartDisplay();
                });
            });
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', function() {
                    const barcode = this.getAttribute('data-barcode');
                    currentCart = currentCart.filter(item => item.barcode !== barcode);
                    updateCartDisplay();
                    showAlert('pos-alert','Item removed from cart!', 'success');
                });
            });
        }

        function completeSale() {
            const sale = {id: Date.now(), date: new Date().toISOString(), items: [...currentCart], total: calculateCartTotal()};
            currentCart.forEach(cartItem => {
                const inventoryItem = inventory.find(item => item.id === cartItem.id);
                if (inventoryItem) inventoryItem.quantity -= cartItem.quantity;
            });
            saveInventory();
            sales.push(sale);
            localStorage.setItem('sales', JSON.stringify(sales));
            generateInvoice(sale);
            currentCart = [];
            updateCartDisplay();
            displayInventory();
            showAlert('pos-alert','Sale completed successfully!','success');
        }

        function calculateCartTotal() { return currentCart.reduce((total, item) => total + (item.price * item.quantity), 0); }

        function generateInvoice(sale) {
            document.getElementById('invoice-number').textContent = sale.id;
            document.getElementById('invoice-date').textContent = new Date(sale.date).toLocaleString();
            const invoiceItemsList = document.getElementById('invoice-items-list');
            invoiceItemsList.innerHTML = '';
            sale.items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${item.name}</td><td>$${item.price.toFixed(2)}</td><td>${item.quantity}</td><td>$${(item.price * item.quantity).toFixed(2)}</td>`;
                invoiceItemsList.appendChild(row);
            });
            document.getElementById('invoice-total-amount').textContent = `$${sale.total.toFixed(2)}`;
            const invoiceContent = document.getElementById('invoice-template').innerHTML;
            const originalContent = document.body.innerHTML;
            document.body.innerHTML = invoiceContent;
            window.print();
            document.body.innerHTML = originalContent;
            // Rebind navigation after restoring body
            document.querySelectorAll('.nav-item').forEach(item => item.addEventListener('click', function() {
                const pageId = this.getAttribute('data-page');
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');
                if (pageId === 'sales') displaySalesHistory();
            }));
            // set active nav to inventory by default
            document.querySelector('.nav-item.active').click();
        }

        function displaySalesHistory() {
            const salesList = document.getElementById('sales-list');
            salesList.innerHTML = '';
            if (sales.length === 0) { salesList.innerHTML = '<p>No sales records found.</p>'; return; }
            const sortedSales = [...sales].sort((a, b) => new Date(b.date) - new Date(a.date));
            sortedSales.forEach(sale => {
                const saleDate = new Date(sale.date).toLocaleString();
                const saleElement = document.createElement('div');
                saleElement.classList.add('invoice-container');
                saleElement.style.marginBottom = '20px';
                let itemsHTML = '';
                sale.items.forEach(item => {
                    itemsHTML += `<tr><td>${item.name}</td><td>$${item.price.toFixed(2)}</td><td>${item.quantity}</td><td>$${(item.price * item.quantity).toFixed(2)}</td></tr>`;
                });
                saleElement.innerHTML = `
                    <h3>Sale #${sale.id} - ${saleDate}</h3>
                    <table>
                        <thead><tr><th>Product</th><th>Price</th><th>Qty</th><th>Total</th></tr></thead>
                        <tbody>${itemsHTML}</tbody>
                        <tfoot><tr><td colspan="3" style="text-align:right;font-weight:bold;">Total:</td><td>$${sale.total.toFixed(2)}</td></tr></tfoot>
                    </table>`;
                salesList.appendChild(saleElement);
            });
        }

        function saveInventory() { localStorage.setItem('inventory', JSON.stringify(inventory)); }

        // Alert helper
        function showAlert(containerId, message, type) {
            const alertContainer = document.getElementById(containerId);
            if (!alertContainer) return;
            alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => { if (alertContainer) alertContainer.innerHTML = ''; }, 3000);
        }
    </script>
</body>
</html>
